# Issue検証・補強（/issue-update）

GitHub Issue を AI が実行可能なタスクに仕上げるコマンドです。評価 → 質問 → 本文更新まで一気通貫で行います。

## 目的

既存の GitHub Issue を「AI（Claude）が `/issue-run` で実装できる精度」に引き上げる。

## 引数

- `$ARGUMENTS`: 対象の GitHub Issue URL または番号
  - URL形式: `https://github.com/owner/repo/issues/123`
  - 番号のみ: `123`
  - **省略した場合**: AI がユーザーに対象 Issue URL を質問します

## 振る舞い

### Phase 1: Issue 取得と評価

1. URL から Issue 番号を抽出する（URL形式の場合）
2. `gh issue view {番号} --json title,body,comments` で Issue の全内容を取得
3. **AI 実行可能性の観点**で評価する：
   - 要件が具体的か（「〜を改善」ではなく「〜を〜に変更」レベル）
   - 完了条件（DoD）が検証可能か
   - スコープが明確か（やること/やらないこと）
   - エッジケースの扱いが定義されているか
   - UI変更の場合、具体的な仕様があるか

### Phase 2: 不足情報の質問（AskUserQuestion ツール使用）

評価の結果、以下のような不足がある場合は **AskUserQuestion ツールを使ってユーザーに質問する**：

- 複数の解釈が可能な要件
- 具体的な値や条件が未定義
- エラー時の挙動が不明
- UI/UXの詳細仕様が不足
- 優先度や制約が不明確

**質問の例：**
```
- 「〜の場合はどう処理しますか？」
- 「〜の値は具体的にいくつですか？」
- 「〜と〜が矛盾していますが、どちらを優先しますか？」
```

**重要**: 不足情報がある場合は必ず質問する。推測で補完しない。

### Phase 3: Issue 本文の更新

質問への回答を得たら、以下の手順で Issue 本文を更新する：

1. 現在の Issue 本文を取得
2. 回答内容を適切なセクションに反映
3. `gh issue edit {番号} --body "..."` で本文を更新
4. 更新完了を報告

## Issue 本文の構造（更新後の理想形）

```markdown
## 背景・目的
{なぜこのタスクが必要か}

## 要件
{具体的で検証可能な要件のリスト}

## 完了条件（DoD）
- [ ] {AI が検証できる具体的な条件}
- [ ] {テスト可能な条件}

## スコープ
### やること
- {明確な実装範囲}

### やらないこと
- {明示的に除外する項目}

## 制約・注意事項
- {技術的制約}
- {エッジケースの扱い}
```

## 評価基準：AI 実行可能性

| レベル | 説明 | アクション |
|--------|------|------------|
| **高** | そのまま `/issue-run` 可能 | 更新不要、実装開始を促す |
| **中** | 軽微な補足で実行可能 | 1-2個の質問で補完 |
| **低** | 大幅な情報不足 | 複数の質問で詳細を確認 |

## 制約（重要）

- **コードを書かない**
- **技術選定・実装方針を書かない**
- **推測で情報を補完しない（必ず質問する）**
- **質問への回答を得たら必ず Issue 本文を更新する**

## 使用例

```
# Issue URL を指定して検証・更新
/issue-update https://github.com/owner/repo/issues/123

# Issue 番号のみでも可
/issue-update 123

# 省略（AI が質問する）
/issue-update
```

## 実行フロー図

```
Issue 取得
    ↓
AI 実行可能性を評価
    ↓
┌─────────────────────────────────────┐
│ 不足情報あり？                        │
│   YES → AskUserQuestion で質問      │
│   NO  → 「実行可能」と報告して終了    │
└─────────────────────────────────────┘
    ↓
回答を受け取る
    ↓
gh issue edit で本文更新
    ↓
更新完了報告
    ↓
「/issue-run {番号} で実装開始できます」
```

## 前提条件

- GitHub CLI (`gh`) がインストールされ、認証済みであること
- 現在のディレクトリが Git リポジトリであること
- リポジトリに対して Issue 編集権限があること

## 完了報告フォーマット

```markdown
## Issue 更新完了

### 補完した情報
- {質問1への回答内容}
- {質問2への回答内容}

### 更新後の Issue
- タイトル: {タイトル}
- URL: {URL}

### AI 実行可能性: 高

`/issue-run {番号}` で実装を開始できます。
```

## 次のステップ

Issue 更新完了後は `/issue-run {番号}` で実装を開始してください。
